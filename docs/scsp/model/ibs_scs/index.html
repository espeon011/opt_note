<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.6">
<title>opt_note.scsp.model.ibs_scs API documentation</title>
<meta name="description" content="`IBS_SCS` アルゴリズム[^1] …">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source > summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible;min-width:max-content}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } });</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
/* Collapse source docstrings */
setTimeout(() => {
[...document.querySelectorAll('.hljs.language-python > .hljs-string')]
.filter(el => el.innerHTML.length > 200 && ['"""', "'''"].includes(el.innerHTML.substring(0, 3)))
.forEach(el => {
let d = document.createElement('details');
d.classList.add('hljs-string');
d.innerHTML = '<summary>"""</summary>' + el.innerHTML.substring(3);
el.replaceWith(d);
});
}, 100);
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>opt_note.scsp.model.ibs_scs</code></h1>
</header>
<section id="section-intro">
<h1 id="ibs_scs"><code>IBS_SCS</code> アルゴリズム<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup></h1>
<ul>
<li>計算量: $O(k^2 \log_2 q + L^* (n \kappa \beta q + \beta q \log_2 \left( \beta q \right)))$<ul>
<li>(補足) $L^*$: このアルゴリズムによって返される解の長さ. $O(nk)$ で上からバウンドできる.</li>
<li>(補足) $\beta$, $\kappa$: ビームサーチのパラメータ.</li>
</ul>
</li>
<li>近似精度: ?</li>
</ul>
<p><code>IBS_SCS</code> は基本的には残された文字列の先頭の文字の中から 1 つを採用して解を拡張していく手続きである.
1 つだけを選択して次の状態とする貪欲法と比較してビームサーチは以下のようにする:</p>
<ul>
<li>状態は複数保持しておき, その状態たちから残された文字列の先頭に現れる文字の 1 つを選択して解を拡張する操作で得られる状態を全て集める.</li>
<li>保持している状態に対して適切な評価を実施して評価が低いものを保持数が基準値を下回るよう切り捨てる.</li>
<li>保持している状態の中に残された文字列が全て空になったものがあれば終了する.</li>
</ul>
<p>この <code>IBS_SCS</code> アルゴリズムは以下の 4 ステップからなる.</p>
<ol>
<li>現在保持している状態から 1 手進めて得られる状態を集める.</li>
<li>残された文字列の SCS 長の推定値を計算し, 各状態に対し評価用のヒューリスティック関数値を計算する.</li>
<li>今回のループで得られた状態の中で無駄な状態を削除する. (2 つの状態の間に支配という関係が定義される. 支配の関係にある 2 つの状態があったとき, うち片方はもう片方の完全劣化のため保持しない)</li>
<li>ヒューリスティック関数値を基準にビーム幅 $\beta$ 分の個数だけ状態を取り出して次のループへ.</li>
</ol>
<p>より具体的な内容は元論文か実装を参照.
ヒューリスティック関数値の計算には一様ランダムに生成された文字列に対する性質が用いられるため,
規則性のある文字列に対する SCS を計算する場合は性能が悪くなるかもしれない.</p>
<div class="footnote">
<hr>
<ol>
<li id="fn:1">
<p>Sayyed Rasoul Mousavi, Fateme Bahri, Farzaneh Sadat Tabataba, An enhanced beam search algorithm for the Shortest Common Supersequence Problem, Engineering Applications of Artificial Intelligence, Volume 25, Issue 3, 2012, Pages 457-467, ISSN 0952-1976, <a href="https://doi.org/10.1016/j.engappai.2011.08.006.">https://doi.org/10.1016/j.engappai.2011.08.006.</a>&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="opt_note.scsp.model.ibs_scs.make_prob_table"><code class="name flex">
<span>def <span class="ident">make_prob_table</span></span>(<span>num_chars: int, max_len: int) ‑> list[list[float]]</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def make_prob_table(num_chars: int, max_len: int) -&gt; list[list[float]]:
    &#34;&#34;&#34;
    以下の値が入っている 2 次元配列 p を返す:
    p[q][k] = 一様ランダムに生成された長さ q の文字列 w と長さ k の文字列 y に対して, w が y の subsequence になる確率
    &#34;&#34;&#34;

    nrow = max_len + 1
    ncol = math.ceil(max_len * math.log2(num_chars)) + 1

    ret = [[0.0 for k in range(ncol)] for q in range(nrow)]
    for q in range(nrow):
        for k in range(ncol):
            if q == 0:
                ret[q][k] = 1.0
            elif q &gt; k:
                ret[q][k] = 0.0
            else:
                tmp1 = 1.0 / num_chars * ret[q - 1][k - 1]
                tmp2 = (num_chars - 1) / num_chars * ret[q][k - 1]
                ret[q][k] = tmp1 + tmp2

    return ret</code></pre>
</details>
<div class="desc"><p>以下の値が入っている 2 次元配列 p を返す:
p[q][k] = 一様ランダムに生成された長さ q の文字列 w と長さ k の文字列 y に対して, w が y の subsequence になる確率</p></div>
</dd>
<dt id="opt_note.scsp.model.ibs_scs.solve"><code class="name flex">
<span>def <span class="ident">solve</span></span>(<span>instance: list[str], beta: int = 100, kappa: int = 7) ‑> str</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def solve(instance: list[str], beta: int = 100, kappa: int = 7) -&gt; str:
    chars = &#34;&#34;.join(sorted(list(set(&#34;&#34;.join(instance)))))
    prob_table = make_prob_table(len(chars), max(len(s) for s in instance))
    states: list[State] = [State(instance)]

    while True:
        # Step 1: Extension
        new_states: list[State] = []
        for state in states:
            for char in chars:
                if state.is_usable(char):
                    new_state = state.use(char)
                    if new_state.is_feasible():
                        return new_state.solution
                    else:
                        new_states.append(new_state)

        # Step 2: Evaluation of candidate solutions
        k = math.ceil(
            math.log2(len(chars))
            * max(
                len(s) - pos
                for state in new_states
                for s, pos in zip(instance, state.positions)
            )
        )
        # k は残りの部分の SCS 長さの推定値を表している.
        # k をどのような値にセットするのがよいのかは Open Problem とされている.

        # 元論文ではこの辺りに評価用ヒューリスティック関数値の計算があった.

        # Step 3: Dominance pruning
        new_states.sort(key=lambda state: state.heuristic(prob_table, k), reverse=True)
        kappa_best_list = new_states[:kappa]
        new_states = [
            new_state
            for new_state in new_states
            if all(not better.dominate(new_state) for better in kappa_best_list)
        ]

        # Step 4: Selection
        states = new_states[:beta]</code></pre>
</details>
<div class="desc"></div>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="opt_note.scsp.model.ibs_scs.State"><code class="flex name class">
<span>class <span class="ident">State</span></span>
<span>(</span><span>instance: list[str])</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class State:
    def __init__(self, instance: list[str]):
        self.instance = instance
        self.positions = [0 for _ in instance]
        self.solution = &#34;&#34;

    def is_feasible(self) -&gt; bool:
        return all(pos == len(s) for s, pos in zip(self.instance, self.positions))

    def is_usable(self, c: str) -&gt; bool:
        for pos, s in zip(self.positions, self.instance):
            if pos &lt; len(s) and s[pos] == c:
                return True

        return False

    def use(self, char: str) -&gt; &#34;State&#34;:
        new_state = copy.deepcopy(self)
        new_state.solution += char
        for idx, (s, pos) in enumerate(zip(self.instance, new_state.positions)):
            if pos &lt; len(s) and s[pos] == char:
                new_state.positions[idx] += 1
        return new_state

    def dominate(self, other: &#34;State&#34;) -&gt; bool:
        geq = all(pos1 &gt;= pos2 for pos1, pos2 in zip(self.positions, other.positions))
        neq = any(pos1 != pos2 for pos1, pos2 in zip(self.positions, other.positions))
        return geq and neq

    def heuristic(self, prob_table: list[list[float]], k: int) -&gt; float:
        ret = 1.0
        for s, pos in zip(self.instance, self.positions):
            ret *= prob_table[len(s) - pos][k]
        return ret</code></pre>
</details>
<div class="desc"></div>
<h3>Methods</h3>
<dl>
<dt id="opt_note.scsp.model.ibs_scs.State.dominate"><code class="name flex">
<span>def <span class="ident">dominate</span></span>(<span>self,<br>other: <a title="opt_note.scsp.model.ibs_scs.State" href="#opt_note.scsp.model.ibs_scs.State">State</a>) ‑> bool</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def dominate(self, other: &#34;State&#34;) -&gt; bool:
    geq = all(pos1 &gt;= pos2 for pos1, pos2 in zip(self.positions, other.positions))
    neq = any(pos1 != pos2 for pos1, pos2 in zip(self.positions, other.positions))
    return geq and neq</code></pre>
</details>
<div class="desc"></div>
</dd>
<dt id="opt_note.scsp.model.ibs_scs.State.heuristic"><code class="name flex">
<span>def <span class="ident">heuristic</span></span>(<span>self, prob_table: list[list[float]], k: int) ‑> float</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def heuristic(self, prob_table: list[list[float]], k: int) -&gt; float:
    ret = 1.0
    for s, pos in zip(self.instance, self.positions):
        ret *= prob_table[len(s) - pos][k]
    return ret</code></pre>
</details>
<div class="desc"></div>
</dd>
<dt id="opt_note.scsp.model.ibs_scs.State.is_feasible"><code class="name flex">
<span>def <span class="ident">is_feasible</span></span>(<span>self) ‑> bool</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def is_feasible(self) -&gt; bool:
    return all(pos == len(s) for s, pos in zip(self.instance, self.positions))</code></pre>
</details>
<div class="desc"></div>
</dd>
<dt id="opt_note.scsp.model.ibs_scs.State.is_usable"><code class="name flex">
<span>def <span class="ident">is_usable</span></span>(<span>self, c: str) ‑> bool</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def is_usable(self, c: str) -&gt; bool:
    for pos, s in zip(self.positions, self.instance):
        if pos &lt; len(s) and s[pos] == c:
            return True

    return False</code></pre>
</details>
<div class="desc"></div>
</dd>
<dt id="opt_note.scsp.model.ibs_scs.State.use"><code class="name flex">
<span>def <span class="ident">use</span></span>(<span>self, char: str) ‑> <a title="opt_note.scsp.model.ibs_scs.State" href="#opt_note.scsp.model.ibs_scs.State">State</a></span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def use(self, char: str) -&gt; &#34;State&#34;:
    new_state = copy.deepcopy(self)
    new_state.solution += char
    for idx, (s, pos) in enumerate(zip(self.instance, new_state.positions)):
        if pos &lt; len(s) and s[pos] == char:
            new_state.positions[idx] += 1
    return new_state</code></pre>
</details>
<div class="desc"></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul>
<li><a href="#ibs_scs">IBS_SCS アルゴリズム</a></li>
</ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="opt_note.scsp.model" href="../index.html">opt_note.scsp.model</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="opt_note.scsp.model.ibs_scs.make_prob_table" href="#opt_note.scsp.model.ibs_scs.make_prob_table">make_prob_table</a></code></li>
<li><code><a title="opt_note.scsp.model.ibs_scs.solve" href="#opt_note.scsp.model.ibs_scs.solve">solve</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="opt_note.scsp.model.ibs_scs.State" href="#opt_note.scsp.model.ibs_scs.State">State</a></code></h4>
<ul class="">
<li><code><a title="opt_note.scsp.model.ibs_scs.State.dominate" href="#opt_note.scsp.model.ibs_scs.State.dominate">dominate</a></code></li>
<li><code><a title="opt_note.scsp.model.ibs_scs.State.heuristic" href="#opt_note.scsp.model.ibs_scs.State.heuristic">heuristic</a></code></li>
<li><code><a title="opt_note.scsp.model.ibs_scs.State.is_feasible" href="#opt_note.scsp.model.ibs_scs.State.is_feasible">is_feasible</a></code></li>
<li><code><a title="opt_note.scsp.model.ibs_scs.State.is_usable" href="#opt_note.scsp.model.ibs_scs.State.is_usable">is_usable</a></code></li>
<li><code><a title="opt_note.scsp.model.ibs_scs.State.use" href="#opt_note.scsp.model.ibs_scs.State.use">use</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.6</a>.</p>
</footer>
</body>
</html>
